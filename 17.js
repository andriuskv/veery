"use strict";(globalThis.webpackChunkveery=globalThis.webpackChunkveery||[]).push([[17],{17:(t,e,n)=>{n.d(e,{Ej:()=>d,Nj:()=>l,fetchPlaylistItems:()=>m,initGoogleAPI:()=>k,kc:()=>c,wz:()=>v,y4:()=>b});var i=n(806),s=n(244),a=n(568);let o=null,r=null,u=null;async function c(){const t=await w("playlists","snippet,contentDetails,status","mine",!0);var e;return e=t.items,o=e.map((t=>({id:t.id,url:`https://youtube.com/playlist?list=${t.id}`,isPrivate:"private"===t.status.privacyStatus,itemCount:t.contentDetails.itemCount,title:t.snippet.title,thumbnail:t.snippet.thumbnails.medium.url}))),o}async function l(t,e){const{items:n}=await w("videos","snippet,contentDetails","id",t);if(n.length){const t=function(t){const e=f(t).map((t=>(t.snippet.resourceId={videoId:t.id},t.snippet.videoOwnerChannelTitle=t.snippet.channelTitle,t.durationInSeconds=g(t.contentDetails.duration)-1,t)));return y(e)}(n);return e.length?p(t,e):t}}function p(t,e){return t.reduce(((t,n)=>(e.some((t=>t.id===n.id))||t.push(n),t)),[])}async function d(t){const{items:e}=await w("playlists","snippet,status","id",t);if(e.length){const t="private"===e[0].status.privacyStatus,n={title:e[0].snippet.title,isPrivate:t};return t&&(n.user=r),n}}async function m(t,e,n=[],s=""){const{error:o,items:r,nextPageToken:u}=await w("playlistItems","snippet","playlistId",t,s);if(o)return console.log(o),n;const c=await async function(t){const e=t.map((t=>t.snippet.resourceId.videoId)).join(),n=await w("videos","contentDetails","id",e);return t.reduce(((t,e)=>{const i=n.items.find((({id:t})=>t===e.snippet.resourceId.videoId));return i&&(e.durationInSeconds=g(i.contentDetails.duration)-1,t.push(e)),t}),[])}(f(r));let l=y(c);if("new"===e)(0,i.w3)("youtube-tracks",{id:t,tracks:l,done:!u});else if("reimport"===e){l=p(l,(0,a.LR)(t).tracks)}return n=n.concat(l),u?m(t,e,n,u):n}function g(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce(((t,e,n)=>t+=e*60**n),0)}function f(t){return t.filter((t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e}))}function h(t){for(const e of["maxres","high"])if(t[e])return t[e].url;return t.medium.url}function y(t){return t.map((t=>{const e=t.snippet.resourceId.videoId;return(0,s.pq)(e,{original:{url:h(t.snippet.thumbnails)},small:{url:t.snippet.thumbnails.medium.url}},!0),{id:e,durationInSeconds:t.durationInSeconds,duration:(0,i.fU)(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:t.snippet.videoOwnerChannelTitle,album:"",artworkId:e,player:"youtube"}}))}async function w(t,e,n,i,s){let a=`part=${e}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;if(s&&(a+=`&pageToken=${s}`),u){if(Date.now()>u.expiresAt){const t=gapi.auth2.getAuthInstance();await t.signIn(),I(t)}a+=`&access_token=${u.token}`}return fetch(`https://www.googleapis.com/youtube/v3/${t}?${a}`).then((t=>t.json()))}function I(t){const e=t.currentUser.get(),n=e.getBasicProfile(),i=e.getAuthResponse();u={token:i.access_token,expiresAt:i.expires_at},r={name:n.getName(),email:n.getEmail(),image:n.getImageUrl()}}function v(){return r}async function b(){const t=gapi.auth2.getAuthInstance();return u=null,r=null,t.signOut()}async function k(t){if(r)return r;await i.Zc.load({src:"https://apis.google.com/js/platform.js"}),await new Promise((t=>gapi.load("auth2",t)));const e=await gapi.auth2.init({client_id:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/youtube.readonly"});return e.isSignedIn.get()?I(e):t&&(await e.signIn(),I(e)),r}}}]);