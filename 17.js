"use strict";(globalThis.webpackChunkveery=globalThis.webpackChunkveery||[]).push([[17],{17:(e,t,n)=>{n.d(t,{Ej:()=>m,Nj:()=>p,fetchPlaylistItems:()=>y,initGoogleAPI:()=>b,kc:()=>u,wz:()=>v,y4:()=>I});var i=n(806),s=n(244),o=n(568);let a=null,r=null,l=null,c=null;async function u(){const e=await k("playlists","snippet,contentDetails,status","mine",!0);var t;return t=e.items,a=t.map((e=>({id:e.id,url:`https://youtube.com/playlist?list=${e.id}`,isPrivate:"private"===e.status.privacyStatus,itemCount:e.contentDetails.itemCount,title:e.snippet.title,thumbnail:e.snippet.thumbnails.medium.url}))),a}async function p(e,t){const{items:n}=await k("videos","snippet,contentDetails","id",e);if(n.length){const e=function(e){const t=h(e).map((e=>(e.snippet.resourceId={videoId:e.id},e.snippet.videoOwnerChannelTitle=e.snippet.channelTitle,e.durationInSeconds=g(e.contentDetails.duration)-1,e)));return w(t)}(n);return t.length?d(e,t):e}}function d(e,t){return e.reduce(((e,n)=>(t.some((e=>e.id===n.id))||e.push(n),e)),[])}async function m(e){const{items:t}=await k("playlists","snippet,status","id",e);if(t.length){const e="private"===t[0].status.privacyStatus,n={title:t[0].snippet.title,isPrivate:e};return e&&(n.user=r),n}}async function y(e,t,n=[],s=""){const{error:a,items:r,nextPageToken:l}=await k("playlistItems","snippet","playlistId",e,s);if(a)return console.log(a),n;const c=await async function(e){const t=e.map((e=>e.snippet.resourceId.videoId)).join(),n=await k("videos","contentDetails","id",t);return e.reduce(((e,t)=>{const i=n.items.find((({id:e})=>e===t.snippet.resourceId.videoId));return i&&(t.durationInSeconds=g(i.contentDetails.duration)-1,e.push(t)),e}),[])}(h(r));let u=w(c);if("new"===t)(0,i.w3)("youtube-tracks",{id:e,tracks:u,done:!l});else if("reimport"===t){u=d(u,(0,o.LR)(e).tracks)}return n=n.concat(u),l?y(e,t,n,l):n}function g(e){if(e.includes("H")||(e=`0H${e}`),!e.includes("M")){const t=e.indexOf("H")+1;e=`${e.slice(0,t)}0M${e.slice(t)}`}return e.includes("S")||(e=`${e}0`),e.match(/\d{1,}/g).reverse().reduce(((e,t,n)=>e+=t*60**n),0)}function h(e){return e.filter((e=>{const t=e.snippet.title;return"Deleted video"!==t&&"Private video"!==t}))}function f(e){for(const t of["maxres","high"])if(e[t])return e[t].url;return e.medium.url}function w(e){return e.map((e=>{const t=e.snippet.resourceId.videoId;return(0,s.pq)(t,{original:{url:f(e.snippet.thumbnails)},small:{url:e.snippet.thumbnails.medium.url}},!0),{id:t,durationInSeconds:e.durationInSeconds,duration:(0,i.fU)(e.durationInSeconds),name:e.snippet.title,title:e.snippet.title,artist:e.snippet.videoOwnerChannelTitle,album:"",artworkId:t,player:"youtube"}}))}async function k(e,t,n,i,s){let o=`part=${t}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;return s&&(o+=`&pageToken=${s}`),l&&(Date.now()>l.expiresAt&&await S(),o+=`&access_token=${l.token}`),fetch(`https://www.googleapis.com/youtube/v3/${e}?${o}`).then((e=>e.json()))}function v(){return r}function I(){l=null,r=null,localStorage.removeItem("yt-token")}async function b(){if(r)return r;const e=JSON.parse(localStorage.getItem("yt-token"));return e&&e.expiresAt>Date.now()?(r={email:e.email,name:e.name,image:e.image},l={token:e.token,expiresAt:e.expiresAt},r):S()}function S(){return new Promise((async e=>{window.onGoogleLibraryLoad=()=>{c=google.accounts.oauth2.initTokenClient({client_id:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/youtube.readonly",callback:async t=>{const n=await(i=t.access_token,fetch(`https://people.googleapis.com/v1/people/me?personFields=emailAddresses,names,photos&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4&access_token=${i}`).then((e=>e.json())));var i;r={email:n.emailAddresses[0].value,name:n.names[0].displayName,image:n.photos[0].url},l={token:t.access_token,expiresAt:Date.now()+1e3*t.expires_in},e(r),localStorage.setItem("yt-token",JSON.stringify({...r,...l}))}}),c.requestAccessToken()},await i.Zc.load({src:"https://accounts.google.com/gsi/client"})}))}}}]);