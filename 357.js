"use strict";(globalThis.webpackChunkveery=globalThis.webpackChunkveery||[]).push([[357],{357:()=>{function t(t,n,e){return new Uint8Array(t,n,e)}function n(t,n,e){return t.slice(n,n+e)}function e(t,n={}){if("little"===n.endian)return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(7===n.shiftBase)return t[0]<<21|t[1]<<14|t[2]<<7|t[3];let e=t[1]<<16|t[2]<<8|t[3];return 4===n.byteCount&&(e=t[0]<<24|e),e}function r(t,n){return new TextDecoder(n).decode(t)}function i(t,n){return new Promise((e=>{const r=new FileReader,i=n?t.slice(0,Math.min(n,t.size)):t;r.onloadend=function({target:t}){e(t.result)},r.readAsArrayBuffer(i)}))}function o(n,r){return e(t(n,r,4),{endian:"big",shiftBase:7})}function a(n,r,i){return 3===i?e(t(n,r,4),{endian:"big"}):o(n,r)}function c(n,e,i){const o=t(n,e,i),[a]=o;if(0===a){const t=r(o,"iso-8859-1");return 0===o[o.length-1]?t.slice(1,-1):t.slice(1)}if(1===a){const t=255===o[1]&&254===o[2]?"utf-16le":"utf-16be",n=o.length%2==0?o.slice(3,-1):o.slice(3);"utf-16be"===t&&(n[0]=0);const e=r(n,t);return 0===o[o.length-1]&&0===o[o.length-2]?e.slice(0,-1):e}if(2===a){return r(o.length%2==0?o.slice(1,-1):o.slice(1),"utf-16le")}if(3===a){const t=r(o,"utf-8");return 0===o[o.length-1]?t.slice(1,-1):t.slice(1)}return r(o,"iso-8859-1")}function s(n,e){const i=r(t(n,e,4));return/\w{4}/.test(i)?i:null}function u(t,n){let e=0;for(;t[n];)n+=1,e+=1;return e}function l(n,e,i){let o=1;const a=t(n,e,i),c=u(a,o),s=r(t(n,e+o,c));o+=c+2;const l=u(a,o)+1;return o+=l,0===a[o+l+1]&&(o+=1),new Blob([a.slice(o)],{type:s})}async function f(n,e,u,y=0,m={}){const b=y,k=o(e,y+=6)+10;for(y+=4,b+k>e.byteLength&&(e=await i(n,b+k+e.byteLength));;){const i=s(e,y),o=a(e,y+=4,u);y+=4;const[g]=t(e,y+1,2),h=(g>>1)%2!=0;if(y+=2,!i){if("ID3"===r(t(e,y=b+k,3)))return f(n,e,u,y,m);break}{const t=w(i);let n=y,r=o;h&&(r=a(e,n,u),n+=4),t&&!m[t]&&(m[t]="picture"===t?l(e,n,r):c(e,n,r))}y+=o}for(;0===new DataView(e,y,1).getUint8(0);)y+=1;let A=0,v=!0;for(;y<e.byteLength;){const o=t(e,y,4);if(255!==o[0]||o[1]<112)return m.duration=d(A,m),m;if(v){m=h(o,m);const a=36,c=r(t(e,y+a,4));if("Xing"===c||"Info"===c)return p(e,y+a,m);e=await i(n),v=!1}A+=1,y+=g(o[2],m)}return m.duration=d(A,m),m}function g(t,{bitrate:n,sampleRate:e}){const r=(2&t)>0?1:0;return Math.floor(144e3*n/e)+r}function h(t,n){const e=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,0],r=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,0],i=[[null,r,r,e],null,[null,r,r,e],[null,[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,0],[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,0],[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,0]]],o=t[1]>>3&3,a=t[1]>>1&3,c=t[2]>>2&3,s=t[2]>>4&15;return n.sampleRate=[[11025,12e3,8e3],null,[22050,24e3,16e3],[44100,48e3,32e3]][o][c],n.samplesPerFrame=[[384,1152,576],null,[384,1152,576],[384,1152,1152]][o][a],n.bitrate=i[o][a][s],n}function d(t,{samplesPerFrame:n,sampleRate:e}){return Math.floor(t*n/e)}function p(n,r,i){const o=e(t(n,r+8,4),{endian:"big"});return i.duration=d(o,i),i}function w(t){return{TIT2:"title",TPE1:"artist",TALB:"album",APIC:"picture"}[t]}function y(t){const n=atob(t),e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}function m(t,r){return e(n(t,r,4),{endian:"big"})}function b(t,e){let i=4;const o=m(t,i);i+=4;const a=r(n(t,i,o));i+=o;const c=m(t,i);i+=4,i+=c,i+=16;const s=m(t,i);return i+=4,e.picture=new Blob([n(t,i,s)],{type:a}),e}function k(t,r){return e(n(t,r,4),{endian:"little"})}function A(t,e,i=0){const o=k(t,i);let a=k(t,i+=o+4);for(i+=4;a;){const o=k(t,i),c=r(n(t,i+=4,o),"utf-8"),[s,u]=c.split("=");"METADATA_BLOCK_PICTURE"===s?e=b(y(u),e):e[s.toLowerCase()]=u,i+=o,a-=1}return e}function v(t,n){const e=M(t.slice(10,13))>>4,r=M([15&t[13],...t.slice(14,18)]);return e&&(n.duration=Math.floor(r/e)),n}function M(t){return t.reduce(((t,n)=>(t<<8)+n),0)}async function I(n,r,o=4){let a={},c=!1;for(;!c;){const s=t(r,o,4),u=e(s,{endian:"big"}),l=s[0],f=127&l;if(c=128==(128&l),(o+=4)+u>r.byteLength&&(r=await i(n,r.byteLength+o+u)),0===f){a=v(t(r,o,u),a)}else if(4===f){a=A(t(r,o,u),a)}else if(6===f){a=b(t(r,o,u),a)}o+=u}return a}function L(t,n){const e=new Uint8Array(t.length+n.length);return e.set(t),e.set(n,t.length),e}function T(t,i){const o=r(n(t,0,5));if("OpusH"===o||"vorb"===o)return function(t,r){return r.sampleRate=e(n(t,12,4),{endian:"little"}),r}(t,i);if("OpusT"===o)return A(t,i,8);if("vorb"===o)return A(t,i,7);throw new Error("Unknown type")}function C(n,r){return e(t(n,r,4),{endian:"big",byteCount:4})}function B(t,n){const e=new DataView(t,n,1).getUint8(0);let r=0,i=0;return n+=4,0===e?(r=C(t,n+=8),i=C(t,n+=4)):(r=C(t,n+=16),i=C(t,(n+=4)+4)),Math.floor(i/r)}function U(n,e,i,o){const a={"©ART":"artist","©nam":"title","©alb":"album","©cmt":"comment","©day":"year","©too":"encoding",covr:"picture"};for(;i;){const s=C(n,e),u=a[r(t(n,e+4,4),"iso-8859-1")],l=24;if(u&&s>l){const i=t(n,e+l,s-l);o[u]="picture"===u?new Blob([i],{type:(c=i,255===c[0]&&216===c[1]?"image/jpg":"PNG"===r(c.slice(0,4))?"image/png":"")}):r(i,"utf-8")}e+=s,i-=s}var c;return o}async function $(n,o){const a=t(o,0,8),c=r(a);if(c.startsWith("ID3")){if(a[3]<3)throw new Error("Unsupported ID3 tag version");const e=function(n){const e=t(n,6,4);return 2097152*e[0]+16384*e[1]+128*e[2]+e[3]}(o)+10;return"fLaC"===r(t(o=await i(n,o.byteLength+e+1024),e,4))?I(n,o,e+4):f(n,o,a[3])}if(c.startsWith("fLaC"))return I(n,o);if(c.startsWith("OggS"))return function(n){let r={},i=0,o=2,a=new Uint8Array;for(;i<n.byteLength;){i+=5;const[c]=t(n,i,1);if(i+=1,4===c){const o=e(t(n,i,4),{endian:"little"});return r.duration=Math.floor(o/r.sampleRate),r}i+=20;const[s]=t(n,i,1);i+=1;const u=t(n,i,s);let l=0;i+=s;for(let t=0;t<s;t++)l+=u[t];if(o){const e=u[u.length-1];a=L(a,t(n,i,l)),l%255==0&&e||(o-=1,r=T(a,r),a=new Uint8Array)}i+=l}}(o=await i(n));if(c.endsWith("ftyp"))return function(n){const e=["moov","mvhd","udta","meta","ilst"];let i={},o=0;for(;e.length&&o<n.byteLength;){const a=C(n,o),c=r(t(n,o+4,4));e[0]===c?(o+=8,e.shift(),"mvhd"===c?(i.duration=B(n,o),o+=a-8):"ilst"===c?i=U(n,o,a-8,i):"meta"===c&&(o+=4)):o+=a}return i}(o=await i(n));throw new Error("Invalid or unsupported file")}!function(){const t=[]}();function R(t,n=!0){return n&&t<10?`0${t}`:t}function P(t,n=!1){const e=function(t){return Math.floor(t/3600)}(t),r=function(t){return Math.floor(t/60%60)}(t),i=function(t){return t%60}(t);return`${(n=n||e)?`${e}:`:""}${R(r,n)}:${R(i)}`}async function D(t){const n=await crypto.subtle.digest("SHA-256",t);return[...new Uint8Array(n)].map((t=>t.toString(16).padStart(2,"0"))).join("")}let E=0;async function j(t,n){delete t.needsMetadata,await async function(t){const{artist:n,title:e,album:r,duration:i,picture:o}=await(a=t.audioTrack,new Promise((t=>{const n=new FileReader,e=Math.min(24576,a.size);n.onloadend=function({target:n}){t($(a,n.result))},n.readAsArrayBuffer(a.slice(0,e))})));var a;t.title=e||t.name,t.artist=n||"",t.album=r||"",t.durationInSeconds=i,t.duration=P(i),postMessage({type:"track",track:t}),o&&(t.picture=o)}(t),async function(t,n){if(t.picture)try{await async function(t){const{picture:n}=t;if(delete t.picture,"OffscreenCanvas"in self){const[e,r]=await Promise.all([x(n),O(n)]);t.artworkId=e,postMessage({type:"track",track:t,artwork:{original:{blob:n},small:{blob:r},type:n.type}})}else{const e=await x(n);t.artworkId=e,postMessage({type:"image",image:{hash:e,file:n},done:E<=1,track:t})}}(t)}catch(t){console.log(t)}!n||t.album&&t.picture||await async function(t){try{const e="https://ws.audioscrobbler.com/2.0/",r=`?method=track.getInfo&api_key=${void 0}&artist=${t.artist}&track=${t.title}&format=json`,i=await fetch(e+r).then((t=>t.json()));if(i.track&&i.track.album){const{title:e,image:r}=i.track.album;let o=!1,a=null;if(!t.album&&e&&(t.album=e,o=!0),!t.artworkId&&r){const e=r[r.length-1]["#text"];if(e){const{origin:r,pathname:i}=new URL(e),[o]=i.split("/").slice(-1),c=`${r}/i/u/500x500/${o}`,s=function(t){const n=t.split(".")[1];if("jpg"===n)return"image/jpeg";return`image/${n}`}(o),u=await(n=c,D(new TextEncoder("utf-8").encode(n).buffer));t.artworkId=u,a={original:{url:c},small:{url:e},type:s}}}(o||a)&&postMessage({type:"track",track:t,artwork:a})}}catch(t){console.log(t)}var n}(t);E-=1,E<=0&&postMessage({type:"track",track:t,done:!0})}(t,n)}async function O(t){const n=await createImageBitmap(t);let{width:e,height:r}=n;const i=Math.min(e,r,256);e<r?(r=i/n.width*r,e=i):(e=i/n.height*e,r=i);const o=new OffscreenCanvas(e,r);return o.getContext("2d").drawImage(n,0,0,e,r),o.convertToBlob({type:t.type,quality:.72})}async function x(t){if(!t)return;return D(await t.arrayBuffer())}onmessage=function(t){const{payload:n,checkLastFm:e}=t.data;Array.isArray(n)?async function(t,n){E=t.length;for(const e of t)try{await j(e,n)}catch(t){console.log(t)}}(n,e):(E=1,j(n,e))}}}]);