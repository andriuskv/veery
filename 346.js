"use strict";(globalThis.webpackChunkveery=globalThis.webpackChunkveery||[]).push([[346,7],{513:(t,e,n)=>{n.d(e,{Z:()=>o});var i=n(294),s=n(353),a=n(461),l=n(893);const o=function({container:t,toggle:e={},body:n,children:o}){const[c,r]=(0,i.useState)({id:(0,s.zO)()}),u=(0,i.useCallback)((function({target:t}){const e=t.closest(".dropdown-container");let n=!0;e?.id===c.id&&(n=!t.closest("[data-dropdown-keep]")&&(t.closest("a")||t.closest(".dropdown-btn")));n&&(d.current&&r({id:c.id,visible:!1,reveal:!1}),window.removeEventListener("click",u))}),[c.id]),d=(0,i.useRef)(!1),p=(0,i.useRef)(null);return(0,i.useEffect)((()=>(d.current=!0,()=>{d.current=!1,window.removeEventListener("click",u)})),[u]),(0,i.useLayoutEffect)((()=>{if(c.reveal){let t=!1;if(c.data){const e=p.current.getBoundingClientRect().height+8;c.data.bottom+e>c.data.height&&c.data.top>e&&(t=!0)}r({...c,onTop:t,visible:!0})}}),[c.reveal]),(0,l.jsxs)("div",{id:c.id,className:`dropdown-container${t?` ${t.className}`:""}${c.visible?" visible":""}`,children:[(0,l.jsx)("button",{className:`btn icon-btn${e.className?` ${e.className}`:""}${c.visible?" active":""}`,onClick:function({currentTarget:t}){let e=null;if(c.visible)window.removeEventListener("click",u);else{const n=t.parentElement,i=function(t){for(;t&&!t.hasAttribute("data-dropdown-parent");)t=t.parentElement;return t}(n);i&&(i.style.position="relative",e={top:n.offsetTop,bottom:n.offsetTop+n.offsetHeight,height:i.scrollTop+i.clientHeight},i.style.position=""),window.addEventListener("click",u)}r({id:c.id,visible:!1,reveal:!c.visible,data:e,onTop:!1})},title:e.title||"More",children:e.body?e.body:(0,l.jsx)(a.Z,{id:e.iconId||"vertical-dots",className:"dropdown-toggle-btn-icon"})}),(0,l.jsx)("div",{ref:p,className:`container dropdown${n?` ${n.className}`:""}${c.reveal?" reveal":""}${c.visible?" visible":""}${c.onTop?" top":""}`,children:o})]})}},346:(t,e,n)=>{n.r(e),n.d(e,{default:()=>g});var i=n(294),s=n(7),a=n(615),l=n(461),o=n(513),c=n(893);const r=function({youtube:t,setYoutube:e}){const{uploadFiles:n}=(0,a.K)(),[r,u]=(0,i.useState)((()=>"true"===localStorage.getItem("use-last.fm")));function d({detail:n}){n&&e({...t,user:n})}function p({target:t}){n([...t.files]),t.value=""}return(0,i.useEffect)((()=>(t.user||window.addEventListener("youtube-user-update",d),()=>{window.removeEventListener("youtube-user-update",d)})),[t.user]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"import-option import-option-local",children:[(0,c.jsxs)("div",{className:"import-local-items",children:[(0,c.jsxs)("label",{className:"btn icon-text-btn import-option-btn import-local-item",onChange:p,children:[(0,c.jsx)(l.Z,{id:"file",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"Files"}),(0,c.jsx)("input",{type:"file",className:"sr-only",accept:"audio/*",multiple:!0})]}),(0,c.jsxs)("label",{className:"btn icon-text-btn import-option-btn import-local-item",onChange:p,children:[(0,c.jsx)(l.Z,{id:"folder",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"Folder"}),(0,c.jsx)("input",{type:"file",className:"sr-only",accept:"audio/*",webkitdirectory:"true",directory:"true",allowdirs:"true"})]})]}),(0,c.jsx)("div",{className:"import-local-settings",children:(0,c.jsxs)("label",{className:"checkbox-container",children:[(0,c.jsx)("input",{type:"checkbox",className:"sr-only checkbox-input",onChange:function({target:t}){u(t.checked),localStorage.setItem("use-last.fm",t.checked)},checked:r}),(0,c.jsx)("div",{className:"checkbox",children:(0,c.jsx)("div",{className:"checkbox-tick"})}),(0,c.jsx)("span",{className:"checkbox-label",children:"Look for missing metadata"})]})})]}),(0,c.jsxs)("div",{className:"import-option import-option-youtube",children:[t.fetching&&(0,c.jsx)(l.Z,{id:"spinner",className:"import-youtube-spinner"}),(0,c.jsxs)("button",{className:"btn icon-text-btn import-option-btn import-youtube-modal-show-btn",onClick:async function(){if(t.playlists)e({...t,modalVisible:!0});else{e({...t,fetching:!0});const n=await(0,s.initGoogleAPI)();if(n){const t=await(0,s.fetchYoutubeUserPlaylists)();e({user:n,playlists:t,modalVisible:!0})}else e({modalVisible:!0})}},disabled:t.fetching,children:[(0,c.jsx)(l.Z,{id:"youtube",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"YouTube"})]}),t.user?(0,c.jsxs)(o.Z,{toggle:{body:(0,c.jsx)("img",{src:t.user.image,className:"import-youtube-user-btn-image",alt:""}),className:"import-youtube-user-toggle-btn"},children:[(0,c.jsxs)("div",{className:"import-youtube-user",children:[(0,c.jsx)("img",{src:t.user.image,className:"import-youtube-user-image",alt:""}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"import-youtube-user-name",children:t.user.name}),(0,c.jsx)("div",{className:"import-youtube-user-email",children:t.user.email})]})]}),(0,c.jsx)("div",{className:"import-youtube-user-bottom",children:(0,c.jsx)("button",{className:"btn text-btn import-youtube-logout-btn",onClick:async function(){await(0,s.logoutUser)(),e({})},children:"Sign Out"})})]}):(0,c.jsx)("button",{className:"btn text-btn import-youtube-login-btn",onClick:async function(){e({fetching:!0});try{const t=await(0,s.initGoogleAPI)(!0);e({user:t})}catch(t){console.log(t),e({})}},disabled:t.fetching,children:"Sign In"})]})]})};var u=n(711),d=n(974),p=n(353),m=n(500),b=n(322);const h=function({youtube:t,setYoutube:e}){const s=(0,d.TH)(),{playlists:r,removePlaylist:h,updatePlaylist:y}=(0,a.K)(),{activePlaylistId:g,paused:x,trackLoading:f,togglePlay:v,playPlaylist:j}=(0,m.n)(),[N,w]=(0,i.useState)(null);function k(t){"Enter"===t.key&&t.target.blur()}function I(t){const{thumbnail:e}=(0,b.mP)(t);return(0,c.jsxs)("div",{className:"playlist-entry-thumbnail-container",children:[(0,c.jsx)(u.rU,{to:`/playlist/${t}`,className:`playlist-entry-thumbnail t-${e.length}`,children:e.map((t=>(0,c.jsx)("div",{className:"playlist-entry-thumbnail-image-container",children:(0,c.jsx)("img",{src:t,className:"artwork",alt:""})},t)))}),P(t)]})}function P(t){let e={iconId:"play-circle",title:"Play"};return g!==t||x||(e={iconId:"pause-circle",title:"Pause"}),(0,c.jsxs)("button",{className:"btn icon-btn playlist-entry-play-btn",title:e.title,onClick:()=>function(t){g===t?v():j(t)}(t),children:[(0,c.jsx)(l.Z,{id:e.iconId,className:"playlist-entry-play-btn-icon"}),g===t&&f&&(0,c.jsx)(l.Z,{id:"spinner",className:"play-pause-btn-spinner"})]})}return r?Object.values(r).map((i=>(0,c.jsxs)("div",{className:"playlist-entry",children:[I(i.id),(0,c.jsxs)("div",{className:"playlist-entry-content",children:[N?.id===i.id?(0,c.jsx)("input",{type:"text",className:"input playlist-entry-title-input",defaultValue:i.title,onBlur:t=>function(t,e){const{title:n}=(0,b.hT)(e),i=t.target.value;i&&i!==n&&y(e,{title:i}),w(null)}(t,i.id),onKeyPress:k,autoFocus:!0}):(0,c.jsx)("h3",{className:"playlist-entry-title",children:i.title}),(0,c.jsxs)("div",{className:"playlist-entry-bottom",children:[i.isPrivate?(0,c.jsx)("span",{className:"playlist-entry-bottom-item",children:(0,c.jsx)(l.Z,{id:"lock",className:"playlist-entry-bottom-icon",title:`Private to ${i.user.name}`})}):null,(0,c.jsxs)("span",{className:"playlist-entry-bottom-item",children:[i.tracks.length," track",1===i.tracks.length?"":"s"]}),(0,c.jsx)("span",{className:"playlist-entry-bottom-item",children:(0,b.mP)(i.id).duration}),(0,c.jsxs)(o.Z,{container:{className:"playlist-entry-dropdown-container"},children:[(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>{return t=i.id,e=i.title,void w({id:t,title:e});var t,e},children:[(0,c.jsx)(l.Z,{id:"edit",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Change Title"})]}),i.url?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("a",{href:i.url,className:"btn icon-text-btn dropdown-btn",target:"_blank",rel:"noreferrer",children:[(0,c.jsx)(l.Z,{id:"link",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Open on YouTube"})]}),(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>async function(i){const{initGoogleAPI:a,fetchPlaylistItems:l}=await Promise.resolve().then(n.bind(n,7));let o=t.user;(0,p.hb)("update-indicator-status",{id:i,visible:!0}),e({...t,playlistId:i,fetching:!0}),o||(o=await a(),"/"===s.pathname&&e({...t,user:o,playlistId:i,fetching:!0})),await l(i),"/"===s.pathname&&e({...t,user:o}),(0,p.hb)("update-indicator-status",{id:i,visible:!1})}(i.id),disabled:t.playlistId===i.id,children:[(0,c.jsx)(l.Z,{id:"sync",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Sync"})]}),(0,c.jsxs)("label",{className:"checkbox-container playlist-entry-dropdown-setting",children:[(0,c.jsx)("input",{type:"checkbox",className:"sr-only checkbox-input",checked:i.sync,onChange:t=>function({target:t},e){y(e,{sync:t.checked})}(t,i.id)}),(0,c.jsx)("div",{className:"checkbox",children:(0,c.jsx)("div",{className:"checkbox-tick"})}),(0,c.jsx)("span",{className:"checkbox-label",children:"Sync on load"})]})]}):null,(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>h(i.id),children:[(0,c.jsx)(l.Z,{id:"trash",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Remove"})]})]})]})]})]},i.id))):null},y=(0,i.lazy)((()=>n.e(466).then(n.bind(n,466))));const g=function(){const[t,e]=(0,i.useState)((()=>({user:(0,s.getUser)()})));return(0,c.jsxs)("div",{className:"home","data-dropdown-parent":!0,children:[(0,c.jsx)(r,{youtube:t,setYoutube:e}),(0,c.jsx)(h,{youtube:t,setYoutube:e}),t.modalVisible&&(0,c.jsx)(i.Suspense,{fallback:null,children:(0,c.jsx)(y,{youtube:t,setYoutube:e})})]})}},7:(t,e,n)=>{n.r(e),n.d(e,{fetchYoutubeUserPlaylists:()=>u,fetchPlaylistTitleAndStatus:()=>m,fetchPlaylistItems:()=>b,initGoogleAPI:()=>w,getUser:()=>j,logoutUser:()=>N,addVideo:()=>d});var i=n(353),s=n(585),a=n(322);let l=!1,o=null,c=null,r="";async function u(){const t=await f("playlists","snippet,contentDetails,status","mine",!0);var e;return e=t.items,o=e.map((t=>({id:t.id,url:`https://youtube.com/playlist?list=${t.id}`,isPrivate:"private"===t.status.privacyStatus,itemCount:t.contentDetails.itemCount,title:t.snippet.title,thumbnail:t.snippet.thumbnails.medium.url}))),o}async function d(t,e){const{items:n}=await f("videos","snippet,contentDetails","id",t);if(n.length){const t=function(t){return x(y(t).map((t=>(t.snippet.resourceId={videoId:t.id},t.snippet.videoOwnerChannelTitle=t.snippet.channelTitle,t.durationInSeconds=h(t.contentDetails.duration)-1,t))))}(n);return e.length?p(t,e):t}}function p(t,e){return t.reduce(((t,n)=>(e.some((t=>t.id===n.id))||t.push(n),t)),[])}async function m(t){const{items:e}=await f("playlists","snippet,status","id",t);if(e.length){const t="private"===e[0].status.privacyStatus,n={title:e[0].snippet.title,isPrivate:t};return t&&(n.user=c),n}}async function b(t,e){const{error:n,items:s,nextPageToken:l}=await f("playlistItems","snippet","playlistId",t,e);n&&console.log(n);const o=await async function(t){const e=t.map((t=>t.snippet.resourceId.videoId)).join(),n=await f("videos","contentDetails","id",e);return t.reduce(((t,e)=>{const i=n.items.find((({id:t})=>t===e.snippet.resourceId.videoId));return i&&(e.durationInSeconds=h(i.contentDetails.duration)-1,t.push(e)),t}),[])}(y(s)),c=p(x(o),(0,a.hT)(t).tracks);if((0,i.hb)("youtube-tracks",{id:t,tracks:c}),l)return b(t,l)}function h(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce(((t,e,n)=>t+=e*60**n),0)}function y(t){return t.filter((t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e}))}function g(t){for(const e of["maxres","high"])if(t[e])return t[e].url;return t.medium.url}function x(t){return t.map((t=>{const e=t.snippet.resourceId.videoId;return(0,s.Qs)(e,{original:{url:g(t.snippet.thumbnails)},small:{url:t.snippet.thumbnails.medium.url}},!0),{id:e,durationInSeconds:t.durationInSeconds,duration:(0,i.mr)(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:t.snippet.videoOwnerChannelTitle,album:"",artworkId:e,player:"youtube"}}))}function f(t,e,n,i,s){let a=`part=${e}&${n}=${i}&maxResults=50&key=undefined`;return s&&(a+=`&pageToken=${s}`),r&&(a+=`&access_token=${r}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${a}`).then((t=>t.json()))}function v(t){const e=t.currentUser.get(),n=e.getBasicProfile();r=e.getAuthResponse().access_token,c={name:n.getName(),email:n.getEmail(),image:n.getImageUrl()}}function j(){return c}async function N(){const t=gapi.auth2.getAuthInstance();return r="",c=null,t.signOut()}async function w(t){if(l)return c;await i.Vs.load({src:"https://apis.google.com/js/platform.js"}),await new Promise((t=>gapi.load("auth2",t)));const e=await gapi.auth2.init({client_id:void 0,scope:"https://www.googleapis.com/auth/youtube.readonly"});return e.isSignedIn.get()?v(e):t&&(await e.signIn(),v(e)),l=!0,c}}}]);