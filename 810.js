"use strict";(globalThis.webpackChunkveery=globalThis.webpackChunkveery||[]).push([[810],{810:(e,t,n)=>{n.r(t),n.d(t,{collectUniqueTracks:()=>s,readItems:()=>d,updateTrackWithMetadata:()=>u,updateTracksWithMetadata:()=>l});var a=n(353),o=n(585);let r=null,i=null;function s(e,t){return e.reduce(((e,n)=>{if(!n.type.startsWith("audio"))return e;const o=(r=n.name.trim()).slice(0,r.lastIndexOf("."));var r;return t.some((e=>e.name===o))||e.push({needsMetadata:!0,id:(0,a.zO)(),audioTrack:n,name:o,title:o,artist:"",album:"",durationInSeconds:0,duration:"",player:"native"}),e}),[])}function c(e,t){return new Promise((s=>{let c=null;"one"===t?(r||(r=new Worker(new URL(n.p+n.u(268),n.b),{type:void 0})),c=r):"many"===t&&(i||(i=new Worker(new URL(n.p+n.u(647),n.b),{type:void 0})),c=i),c.addEventListener("message",function(e){return function t({target:n,data:r}){const{type:i,track:s,artwork:c,done:u=!1}=r;"track"===i?((0,a.hb)("track",{track:s,done:u}),c&&(0,o.Qs)(s.artworkId,c),u&&(n.removeEventListener("message",t),e(s))):"image"===i&&function(e,{hash:t,file:n},r){const i=new Image,s=document.createElement("canvas"),c=s.getContext("2d");i.crossOrigin="anonymous",i.onload=function(){let{width:u,height:l}=i;const d=Math.min(u,l,256);u<l?(l=d/i.width*l,u=d):(u=d/i.height*u,l=d),s.width=u,s.height=l,c.drawImage(i,0,0,u,l),s.toBlob((i=>{(0,o.Qs)(t,{original:{blob:n},small:{blob:i},type:n.type}),(0,a.hb)("track",{track:e,done:r})}),n.type,.72),URL.revokeObjectURL(i.src)},i.src=URL.createObjectURL(n)}(s,r.image,u)}}(s)),c.postMessage({payload:e,checkLastFm:"true"===localStorage.getItem("use-last.fm")})}))}function u(e){return c(e,"one")}function l(e){return c(e,"many")}async function d(e){const t=[],n=[];for(const a of e)if("file"===a.kind&&(""===a.type||a.type.startsWith("audio"))){const e=a.webkitGetAsEntry();e.isDirectory?n.push(f(e)):e.isFile&&t.push(h(e))}const a=await Promise.all([...n,...t]);let o=[];for(const e of a)Array.isArray(e)?o=o.concat(e):o.push(e);return o}function f(e){return new Promise((t=>{const n=e.createReader();let a=[];!function e(){n.readEntries((async n=>{if(n.length>0){for(const e of n)if(e.isFile){const t=await h(e);t.type.startsWith("audio")&&a.push(t)}else if(e.isDirectory){const t=await f(e);a=a.concat(t)}e()}else t(a)}))}()}))}function h(e){return new Promise((t=>{e.file(t)}))}document.addEventListener("paste",(async e=>{const t="function"==typeof navigator?.clipboard?.read?await navigator.clipboard.read():e.clipboardData.files,n=[];e.preventDefault();for(const e of t)if(e.type?.startsWith("audio/"))n.push(e);else{const t=e.types?.filter((e=>e.startsWith("audio/")));for(const a of t){const t=await e.getType(a);n.push(t)}}n.length&&(0,a.hb)("file-handler",n)})),"launchQueue"in window&&"files"in window.LaunchParams.prototype&&window.launchQueue.setConsumer((async e=>{if(console.log(e),!e.files.length)return;const t=[];for(const n of e.files){const e=await n.getFile();t.push(e)}t.length&&(0,a.hb)("file-handler",t)}))}}]);