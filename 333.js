"use strict";(globalThis.webpackChunkveery=globalThis.webpackChunkveery||[]).push([[333,7],{623:(t,e,n)=>{n.d(e,{Z:()=>o});var s=n(294),i=n(353),a=n(461),l=n(893);const o=function({container:t,toggle:e={},body:n,children:o}){const[c,r]=(0,s.useState)({id:(0,i.zO)()}),u=(0,s.useCallback)((function({target:t}){const e=t.closest(".dropdown-container");let n=!0;e?.id===c.id&&(n=!t.closest("[data-dropdown-keep]")&&(t.closest("a")||t.closest(".dropdown-btn")));n&&(d.current&&r({id:c.id,visible:!1,reveal:!1}),window.removeEventListener("click",u))}),[c.id]),d=(0,s.useRef)(!1),p=(0,s.useRef)(null);return(0,s.useEffect)((()=>(d.current=!0,()=>{d.current=!1,window.removeEventListener("click",u)})),[u]),(0,s.useLayoutEffect)((()=>{if(c.reveal){let t=!1;if(c.data){const e=p.current.getBoundingClientRect().height+8;c.data.bottom+e>c.data.height&&c.data.top>e&&(t=!0)}r({...c,onTop:t,visible:!0})}}),[c.reveal]),(0,l.jsxs)("div",{id:c.id,className:`dropdown-container${t?` ${t.className}`:""}${c.visible?" visible":""}`,children:[(0,l.jsx)("button",{className:`btn icon-btn${e.className?` ${e.className}`:""}${c.visible?" active":""}`,onClick:function({currentTarget:t}){let e=null;if(c.visible)window.removeEventListener("click",u);else{const n=t.parentElement,s=function(t){for(;t&&!t.hasAttribute("data-dropdown-parent");)t=t.parentElement;return t}(n);s&&(s.style.position="relative",e={top:n.offsetTop,bottom:n.offsetTop+n.offsetHeight,height:s.scrollTop+s.clientHeight},s.style.position=""),window.addEventListener("click",u)}r({id:c.id,visible:!1,reveal:!c.visible,data:e,onTop:!1})},title:e.title||"More",children:e.body?e.body:(0,l.jsx)(a.Z,{id:e.iconId||"vertical-dots",className:"dropdown-toggle-btn-icon"})}),(0,l.jsx)("div",{ref:p,className:`container dropdown${n?` ${n.className}`:""}${c.reveal?" reveal":""}${c.visible?" visible":""}${c.onTop?" top":""}`,children:o})]})}},333:(t,e,n)=>{n.r(e),n.d(e,{default:()=>f});var s=n(294),i=n(7),a=n(615),l=n(461),o=n(623),c=n(893);const r=function({youtube:t,setYoutube:e}){const{uploadFiles:n}=(0,a.K)(),[r,u]=(0,s.useState)((()=>"true"===localStorage.getItem("use-last.fm")));function d({detail:n}){n&&e({...t,user:n})}function p({target:t}){n([...t.files]),t.value=""}return(0,s.useEffect)((()=>(t.user||window.addEventListener("youtube-user-update",d),()=>{window.removeEventListener("youtube-user-update",d)})),[t.user]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"import-option import-option-local",children:[(0,c.jsxs)("div",{className:"import-local-items",children:[(0,c.jsxs)("label",{className:"btn icon-text-btn import-option-btn import-local-item",onChange:p,children:[(0,c.jsx)(l.Z,{id:"file",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"Files"}),(0,c.jsx)("input",{type:"file",className:"sr-only",accept:"audio/*",multiple:!0})]}),(0,c.jsxs)("label",{className:"btn icon-text-btn import-option-btn import-local-item",onChange:p,children:[(0,c.jsx)(l.Z,{id:"folder",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"Folder"}),(0,c.jsx)("input",{type:"file",className:"sr-only",accept:"audio/*",webkitdirectory:"true",directory:"true",allowdirs:"true"})]})]}),(0,c.jsx)("div",{className:"import-local-settings",children:(0,c.jsxs)("label",{className:"checkbox-container",children:[(0,c.jsx)("input",{type:"checkbox",className:"sr-only checkbox-input",onChange:function({target:t}){u(t.checked),localStorage.setItem("use-last.fm",t.checked)},checked:r}),(0,c.jsx)("div",{className:"checkbox",children:(0,c.jsx)("div",{className:"checkbox-tick"})}),(0,c.jsx)("span",{className:"checkbox-label",children:"Look for missing metadata"})]})})]}),(0,c.jsxs)("div",{className:"import-option import-option-youtube",children:[t.fetching&&(0,c.jsx)(l.Z,{id:"spinner",className:"import-youtube-spinner"}),(0,c.jsxs)("button",{className:"btn icon-text-btn import-option-btn import-youtube-modal-show-btn",onClick:async function(){if(t.playlists)e({...t,modalVisible:!0});else{e({...t,fetching:!0});const n=await(0,i.initGoogleAPI)();if(n){const t=await(0,i.fetchYoutubeUserPlaylists)();e({user:n,playlists:t,modalVisible:!0})}else e({modalVisible:!0})}},disabled:t.fetching,children:[(0,c.jsx)(l.Z,{id:"youtube",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"YouTube"})]}),t.user?(0,c.jsxs)(o.Z,{toggle:{body:(0,c.jsx)("img",{src:t.user.image,className:"import-youtube-user-btn-image",alt:""}),className:"import-youtube-user-toggle-btn"},children:[(0,c.jsxs)("div",{className:"import-youtube-user",children:[(0,c.jsx)("img",{src:t.user.image,className:"import-youtube-user-image",alt:""}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"import-youtube-user-name",children:t.user.name}),(0,c.jsx)("div",{className:"import-youtube-user-email",children:t.user.email})]})]}),(0,c.jsx)("div",{className:"import-youtube-user-bottom",children:(0,c.jsx)("button",{className:"btn text-btn import-youtube-logout-btn",onClick:async function(){await(0,i.logoutUser)(),e({})},children:"Sign Out"})})]}):(0,c.jsx)("button",{className:"btn text-btn import-youtube-login-btn",onClick:async function(){e({fetching:!0});try{const t=await(0,i.initGoogleAPI)(!0);e({user:t})}catch(t){console.log(t),e({})}},disabled:t.fetching,children:"Sign In"})]})]})};var u=n(711),d=n(974),p=n(353),m=n(322),b=n(676),h=n(465),y=n(29);const g=function({youtube:t,setYoutube:e}){const i=(0,d.TH)(),{playlists:r,removePlaylist:g,updatePlaylist:x}=(0,a.K)(),{activePlaylistId:f,activeTrack:v,paused:j,trackLoading:N,togglePlay:w,playPlaylist:k}=(0,y.n)(),[I,P]=(0,s.useState)(null);function $(t){"Enter"===t.key&&t.target.blur()}function T(t){const{thumbnail:e}=(0,m.mP)(t);return(0,c.jsxs)("div",{className:"playlist-entry-thumbnail-container",children:[(0,c.jsx)(u.rU,{to:`/playlist/${t}`,className:`playlist-entry-thumbnail t-${e.length}`,children:e.map((t=>(0,c.jsx)("div",{className:"playlist-entry-thumbnail-image-container",children:(0,c.jsx)("img",{src:t,className:"artwork",alt:""})},t)))}),S(t)]})}function S(t){let e={iconId:"play-circle",title:"Play"};return f!==t||j||(e={iconId:"pause-circle",title:"Pause"}),(0,c.jsxs)("button",{className:"btn icon-btn playlist-entry-play-btn",title:e.title,onClick:()=>function(t){f===t?w():k(t)}(t),children:[(0,c.jsx)(l.Z,{id:e.iconId,className:"playlist-entry-play-btn-icon"}),f===t&&N&&(0,c.jsx)(l.Z,{id:"spinner",className:"play-pause-btn-spinner"})]})}return r?Object.values(r).map((s=>(0,c.jsxs)("div",{className:"playlist-entry",children:[T(s.id),(0,c.jsxs)("div",{className:"playlist-entry-content",children:[I?.id===s.id?(0,c.jsx)("input",{type:"text",className:"input playlist-entry-title-input",defaultValue:s.title,onBlur:t=>function(t,e){const{title:n}=(0,m.hT)(e),s=t.target.value;s&&s!==n&&x(e,{title:s}),P(null)}(t,s.id),onKeyPress:$,autoFocus:!0}):(0,c.jsx)("h3",{className:"playlist-entry-title",children:s.title}),(0,c.jsxs)("div",{className:"playlist-entry-bottom",children:[s.isPrivate?(0,c.jsx)("span",{className:"playlist-entry-bottom-item",children:(0,c.jsx)(l.Z,{id:"lock",className:"playlist-entry-bottom-icon",title:`Private to ${s.user.name}`})}):null,(0,c.jsxs)("span",{className:"playlist-entry-bottom-item",children:[s.tracks.length," track",1===s.tracks.length?"":"s"]}),(0,c.jsx)("span",{className:"playlist-entry-bottom-item",children:(0,m.mP)(s.id).duration}),(0,c.jsxs)(o.Z,{container:{className:"playlist-entry-dropdown-container"},children:[(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>{return t=s.id,e=s.title,void P({id:t,title:e});var t,e},children:[(0,c.jsx)(l.Z,{id:"edit",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Change Title"})]}),s.url?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>async function(s){const{initGoogleAPI:a,fetchPlaylistItems:l}=await Promise.resolve().then(n.bind(n,7));let o=t.user;(0,p.hb)("update-indicator-status",{id:s,visible:!0}),e({...t,playlistId:s,fetching:!0}),o||(o=await a(),"/"===i.pathname&&e({...t,user:o,playlistId:s,fetching:!0}));const c=await l(s,"sync");x(s,{tracks:(0,m.jg)(c)}),(0,p.hb)("tracks",{id:s,type:"replace"}),s===f&&((0,h.X5)(s),v&&((0,b.Rh)(),(0,b.ul)(v.index,s))),"/"===i.pathname&&e({...t,user:o}),(0,p.hb)("update-indicator-status",{id:s,visible:!1})}(s.id),disabled:t.playlistId===s.id,children:[(0,c.jsx)(l.Z,{id:"sync",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Sync to YouTube"})]}),(0,c.jsxs)("a",{href:s.url,className:"btn icon-text-btn dropdown-btn",target:"_blank",rel:"noreferrer",children:[(0,c.jsx)(l.Z,{id:"link",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Open on YouTube"})]}),(0,c.jsxs)("label",{className:"checkbox-container playlist-entry-dropdown-setting",children:[(0,c.jsx)("input",{type:"checkbox",className:"sr-only checkbox-input",checked:s.sync,onChange:t=>function({target:t},e){x(e,{sync:t.checked})}(t,s.id)}),(0,c.jsx)("div",{className:"checkbox",children:(0,c.jsx)("div",{className:"checkbox-tick"})}),(0,c.jsx)("span",{className:"checkbox-label",children:"Sync on load"})]})]}):null,(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>g(s.id),children:[(0,c.jsx)(l.Z,{id:"trash",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Remove"})]})]})]})]})]},s.id))):null},x=(0,s.lazy)((()=>n.e(542).then(n.bind(n,542))));const f=function(){const[t,e]=(0,s.useState)((()=>({user:(0,i.getUser)()})));return(0,c.jsxs)("div",{className:"home","data-dropdown-parent":!0,children:[(0,c.jsx)(r,{youtube:t,setYoutube:e}),(0,c.jsx)(g,{youtube:t,setYoutube:e}),t.modalVisible&&(0,c.jsx)(s.Suspense,{fallback:null,children:(0,c.jsx)(x,{youtube:t,setYoutube:e})})]})}},7:(t,e,n)=>{n.r(e),n.d(e,{fetchYoutubeUserPlaylists:()=>r,fetchPlaylistTitleAndStatus:()=>p,fetchPlaylistItems:()=>m,initGoogleAPI:()=>N,getUser:()=>v,logoutUser:()=>j,addVideo:()=>u});var s=n(353),i=n(585),a=n(322);let l=null,o=null,c="";async function r(){const t=await x("playlists","snippet,contentDetails,status","mine",!0);var e;return e=t.items,l=e.map((t=>({id:t.id,url:`https://youtube.com/playlist?list=${t.id}`,isPrivate:"private"===t.status.privacyStatus,itemCount:t.contentDetails.itemCount,title:t.snippet.title,thumbnail:t.snippet.thumbnails.medium.url}))),l}async function u(t,e){const{items:n}=await x("videos","snippet,contentDetails","id",t);if(n.length){const t=function(t){return g(h(t).map((t=>(t.snippet.resourceId={videoId:t.id},t.snippet.videoOwnerChannelTitle=t.snippet.channelTitle,t.durationInSeconds=b(t.contentDetails.duration)-1,t))))}(n);return e.length?d(t,e):t}}function d(t,e){return t.reduce(((t,n)=>(e.some((t=>t.id===n.id))||t.push(n),t)),[])}async function p(t){const{items:e}=await x("playlists","snippet,status","id",t);if(e.length){const t="private"===e[0].status.privacyStatus,n={title:e[0].snippet.title,isPrivate:t};return t&&(n.user=o),n}}async function m(t,e,n=[],i=""){const{error:l,items:o,nextPageToken:c}=await x("playlistItems","snippet","playlistId",t,i);l&&console.log(l);const r=await async function(t){const e=t.map((t=>t.snippet.resourceId.videoId)).join(),n=await x("videos","contentDetails","id",e);return t.reduce(((t,e)=>{const s=n.items.find((({id:t})=>t===e.snippet.resourceId.videoId));return s&&(e.durationInSeconds=b(s.contentDetails.duration)-1,t.push(e)),t}),[])}(h(o));let u=g(r);if("new"===e)(0,s.hb)("youtube-tracks",{id:t,tracks:u,done:!c});else if("reimport"===e){u=d(u,(0,a.hT)(t).tracks)}return n=n.concat(u),c?m(t,e,n,c):n}function b(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce(((t,e,n)=>t+=e*60**n),0)}function h(t){return t.filter((t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e}))}function y(t){for(const e of["maxres","high"])if(t[e])return t[e].url;return t.medium.url}function g(t){return t.map((t=>{const e=t.snippet.resourceId.videoId;return(0,i.Qs)(e,{original:{url:y(t.snippet.thumbnails)},small:{url:t.snippet.thumbnails.medium.url}},!0),{id:e,durationInSeconds:t.durationInSeconds,duration:(0,s.mr)(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:t.snippet.videoOwnerChannelTitle,album:"",artworkId:e,player:"youtube"}}))}function x(t,e,n,s,i){let a=`part=${e}&${n}=${s}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;return i&&(a+=`&pageToken=${i}`),c&&(a+=`&access_token=${c}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${a}`).then((t=>t.json()))}function f(t){const e=t.currentUser.get(),n=e.getBasicProfile();c=e.getAuthResponse().access_token,o={name:n.getName(),email:n.getEmail(),image:n.getImageUrl()}}function v(){return o}async function j(){const t=gapi.auth2.getAuthInstance();return c="",o=null,t.signOut()}async function N(t){if(o)return o;await s.Vs.load({src:"https://apis.google.com/js/platform.js"}),await new Promise((t=>gapi.load("auth2",t)));const e=await gapi.auth2.init({client_id:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/youtube.readonly"});return e.isSignedIn.get()?f(e):t&&(await e.signIn(),f(e)),o}}}]);