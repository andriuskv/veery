"use strict";(globalThis.webpackChunkveery=globalThis.webpackChunkveery||[]).push([[17,695],{17:(e,t,n)=>{n.d(t,{Ej:()=>m,Nj:()=>d,fetchPlaylistItems:()=>b,initGoogleAPI:()=>k,kc:()=>u,wz:()=>v,y4:()=>j});var s=n(806),i=n(244),a=n(568);let o=null,l=null,c=null,r=null;async function u(){const e=await f("playlists","snippet,contentDetails,status","mine",!0);var t;return t=e.items,o=t.map(e=>({id:e.id,url:`https://youtube.com/playlist?list=${e.id}`,isPrivate:"private"===e.status.privacyStatus,itemCount:e.contentDetails.itemCount,title:e.snippet.title,thumbnail:e.snippet.thumbnails.medium.url})),o}async function d(e,t){const{items:n}=await f("videos","snippet,contentDetails","id",e);if(n.length){const e=function(e){const t=h(e).map(e=>(e.snippet.resourceId={videoId:e.id},e.snippet.videoOwnerChannelTitle=e.snippet.channelTitle,e.durationInSeconds=y(e.contentDetails.duration)-1,e));return g(t)}(n);return t.length?p(e,t):e}}function p(e,t){return e.reduce((e,n)=>(t.some(e=>e.id===n.id)||e.push(n),e),[])}async function m(e){const{items:t}=await f("playlists","snippet,status","id",e);if(t.length){const e="private"===t[0].status.privacyStatus,n={title:t[0].snippet.title,isPrivate:e};return e&&(n.user=l),n}}async function b(e,t,n=[],i=""){const{error:o,items:l,nextPageToken:c}=await f("playlistItems","snippet","playlistId",e,i);if(o)return console.log(o),n;const r=await async function(e){const t=e.map(e=>e.snippet.resourceId.videoId).join(),n=await f("videos","contentDetails","id",t);return e.reduce((e,t)=>{const s=n.items.find(({id:e})=>e===t.snippet.resourceId.videoId);return s&&(t.durationInSeconds=y(s.contentDetails.duration)-1,e.push(t)),e},[])}(h(l));let u=g(r);if("new"===t)(0,s.w3)("youtube-tracks",{id:e,tracks:u,done:!c});else if("reimport"===t){u=p(u,(0,a.LR)(e).tracks)}return n=n.concat(u),c?b(e,t,n,c):n}function y(e){if(e.includes("H")||(e=`0H${e}`),!e.includes("M")){const t=e.indexOf("H")+1;e=`${e.slice(0,t)}0M${e.slice(t)}`}return e.includes("S")||(e=`${e}0`),e.match(/\d{1,}/g).reverse().reduce((e,t,n)=>e+=t*60**n,0)}function h(e){return e.filter(e=>{const t=e.snippet.title;return"Deleted video"!==t&&"Private video"!==t})}function x(e){for(const t of["maxres","high"])if(e[t])return e[t].url;return e.medium.url}function g(e){return e.map(e=>{const t=e.snippet.resourceId.videoId;return(0,i.pq)(t,{original:{url:x(e.snippet.thumbnails)},small:{url:e.snippet.thumbnails.medium.url}},!0),{id:t,durationInSeconds:e.durationInSeconds,duration:(0,s.fU)(e.durationInSeconds),name:e.snippet.title,title:e.snippet.title,artist:e.snippet.videoOwnerChannelTitle,album:"",artworkId:t,player:"youtube"}})}async function f(e,t,n,s,i){let a=`part=${t}&${n}=${s}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;return i&&(a+=`&pageToken=${i}`),c&&(Date.now()>c.expiresAt&&await w(),a+=`&access_token=${c.token}`),fetch(`https://www.googleapis.com/youtube/v3/${e}?${a}`).then(e=>e.json())}function v(){return l}function j(){c=null,l=null,localStorage.removeItem("yt-token")}async function k(){if(l)return l;const e=JSON.parse(localStorage.getItem("yt-token"));return e&&e.expiresAt>Date.now()?(l={email:e.email,name:e.name,image:e.image},c={token:e.token,expiresAt:e.expiresAt},l):w()}function w(){return new Promise(async e=>{window.onGoogleLibraryLoad=()=>{r=google.accounts.oauth2.initTokenClient({client_id:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/youtube.readonly",callback:async t=>{const n=await(s=t.access_token,fetch(`https://people.googleapis.com/v1/people/me?personFields=emailAddresses,names,photos&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4&access_token=${s}`).then(e=>e.json()));var s;l={email:n.emailAddresses[0].value,name:n.names[0].displayName,image:n.photos[0].url},c={token:t.access_token,expiresAt:Date.now()+1e3*t.expires_in},e(l),localStorage.setItem("yt-token",JSON.stringify({...l,...c}))}}),r.requestAccessToken()},await s.Zc.load({src:"https://accounts.google.com/gsi/client"})})}},527:(e,t,n)=>{n.d(t,{A:()=>l});var s=n(540),i=n(806),a=n(123),o=n(848);const l=function({container:e,toggle:t={},body:n,children:l}){const[c,r]=(0,s.useState)({id:(0,i.$f)()}),u=(0,s.useCallback)(function({target:e}){const t=e.closest(".dropdown-container");let n=!0;t?.id===c.id&&(n=!e.closest("[data-dropdown-keep]")&&(e.closest("a")||e.closest(".dropdown-btn")));n&&(d.current&&r({id:c.id,visible:!1,reveal:!1}),window.removeEventListener("click",u))},[c.id]),d=(0,s.useRef)(!1),p=(0,s.useRef)(null);return(0,s.useEffect)(()=>(d.current=!0,()=>{d.current=!1,window.removeEventListener("click",u)}),[u]),(0,s.useLayoutEffect)(()=>{if(c.reveal){let e=!1;if(c.data){const t=p.current.getBoundingClientRect().height+8;c.data.bottom+t>c.data.height&&c.data.top>t&&(e=!0)}r({...c,onTop:e,visible:!0})}},[c.reveal]),(0,o.jsxs)("div",{id:c.id,className:`dropdown-container${e?` ${e.className}`:""}${c.visible?" visible":""}`,children:[(0,o.jsx)("button",{className:`btn icon-btn${t.className?` ${t.className}`:""}${c.visible?" active":""}`,onClick:function({currentTarget:e}){let t=null;if(c.visible)window.removeEventListener("click",u);else{const n=e.parentElement,s=function(e){for(;e&&!e.hasAttribute("data-dropdown-parent");)e=e.parentElement;return e}(n);s&&(s.style.position="relative",t={top:n.offsetTop,bottom:n.offsetTop+n.offsetHeight,height:s.scrollTop+s.clientHeight},s.style.position=""),window.addEventListener("click",u)}r({id:c.id,visible:!1,reveal:!c.visible,data:t,onTop:!1})},title:t.title||"More",children:t.body?t.body:(0,o.jsx)(a.A,{id:t.iconId||"vertical-dots",className:"dropdown-toggle-btn-icon"})}),(0,o.jsx)("div",{ref:p,className:`container dropdown${n?` ${n.className}`:""}${c.reveal?" reveal":""}${c.visible?" visible":""}${c.onTop?" top":""}`,children:l})]})}},695:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var s=n(540),i=n(17),a=n(584),o=n(123),l=n(527),c=n(848);const r=function({youtube:e,setYoutube:t}){const{uploadFiles:n}=(0,a.n)(),[r,u]=(0,s.useState)(()=>"true"===localStorage.getItem("use-last.fm"));function d({detail:n}){n&&t({...e,user:n})}function p({target:e}){n([...e.files]),e.value=""}return(0,s.useEffect)(()=>(e.user||window.addEventListener("youtube-user-update",d),()=>{window.removeEventListener("youtube-user-update",d)}),[e.user]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"import-option import-option-local",children:[(0,c.jsxs)("div",{className:"import-local-items",children:[(0,c.jsxs)("label",{className:"btn icon-text-btn import-option-btn import-local-item",onChange:p,children:[(0,c.jsx)(o.A,{id:"file",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"Files"}),(0,c.jsx)("input",{type:"file",className:"sr-only",accept:"audio/*",multiple:!0})]}),(0,c.jsxs)("label",{className:"btn icon-text-btn import-option-btn import-local-item",onChange:p,children:[(0,c.jsx)(o.A,{id:"folder",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"Folder"}),(0,c.jsx)("input",{type:"file",className:"sr-only",webkitdirectory:"true",directory:"true",allowdirs:"true"})]})]}),(0,c.jsx)("div",{className:"import-local-settings",children:(0,c.jsxs)("label",{className:"checkbox-container",children:[(0,c.jsx)("input",{type:"checkbox",className:"sr-only checkbox-input",onChange:function({target:e}){u(e.checked),localStorage.setItem("use-last.fm",e.checked)},checked:r}),(0,c.jsx)("div",{className:"checkbox",children:(0,c.jsx)("div",{className:"checkbox-tick"})}),(0,c.jsx)("span",{className:"checkbox-label",children:"Look for missing metadata"})]})})]}),(0,c.jsxs)("div",{className:"import-option import-option-youtube",children:[e.fetching&&(0,c.jsx)(o.A,{id:"spinner",className:"import-youtube-spinner"}),(0,c.jsxs)("button",{className:"btn icon-text-btn import-option-btn import-youtube-modal-show-btn",onClick:async function(){if(e.playlists)t({...e,modalVisible:!0});else{t({...e,fetching:!0});const n=await(0,i.initGoogleAPI)();if(n){const e=await(0,i.kc)();t({user:n,playlists:e,modalVisible:!0})}else t({modalVisible:!0})}},disabled:e.fetching,children:[(0,c.jsx)(o.A,{id:"youtube",className:"import-option-btn-icon"}),(0,c.jsx)("span",{children:"YouTube"})]}),e.user?(0,c.jsxs)(l.A,{toggle:{body:(0,c.jsx)("img",{src:e.user.image,className:"import-youtube-user-btn-image",alt:""}),className:"import-youtube-user-toggle-btn"},children:[(0,c.jsxs)("div",{className:"import-youtube-user",children:[(0,c.jsx)("img",{src:e.user.image,className:"import-youtube-user-image",alt:""}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"import-youtube-user-name",children:e.user.name}),(0,c.jsx)("div",{className:"import-youtube-user-email",children:e.user.email})]})]}),(0,c.jsx)("div",{className:"import-youtube-user-bottom",children:(0,c.jsx)("button",{className:"btn text-btn import-youtube-logout-btn",onClick:async function(){(0,i.y4)(),t({})},children:"Sign Out"})})]}):(0,c.jsx)("button",{className:"btn text-btn import-youtube-login-btn",onClick:async function(){t({fetching:!0});try{const e=await(0,i.initGoogleAPI)(!0);t({user:e})}catch(e){console.log(e),t({})}},disabled:e.fetching,children:"Sign In"})]})]})};var u=n(526),d=n(806),p=n(568),m=n(400),b=n(440),y=n(295);const h=function({youtube:e,setYoutube:t}){const i=(0,u.zy)(),{playlists:r,removePlaylist:h,updatePlaylist:x}=(0,a.n)(),{activePlaylistId:g,activeTrack:f,paused:v,trackLoading:j,togglePlay:k,playPlaylist:w}=(0,y.F)(),[N,I]=(0,s.useState)(null);function A(e){"Enter"===e.key&&e.target.blur()}function S(e){const{thumbnail:t}=(0,p.qX)(e);return(0,c.jsxs)("div",{className:"playlist-entry-thumbnail-container",children:[(0,c.jsx)(u.N_,{to:`/playlist/${e}`,className:`playlist-entry-thumbnail t-${t.length}`,draggable:"false",children:t.map(e=>(0,c.jsx)("div",{className:"playlist-entry-thumbnail-image-container",children:(0,c.jsx)("img",{src:e,className:"artwork",alt:""})},e))}),$(e)]})}function $(e){let t={iconId:"play-circle",title:"Play"};return g!==e||v||(t={iconId:"pause-circle",title:"Pause"}),(0,c.jsxs)("button",{className:"btn icon-btn playlist-entry-play-btn",title:t.title,onClick:()=>function(e){g===e?k():w(e)}(e),children:[(0,c.jsx)(o.A,{id:t.iconId,className:"playlist-entry-play-btn-icon"}),g===e&&j&&(0,c.jsx)(o.A,{id:"spinner",className:"play-pause-btn-spinner"})]})}return r?Object.values(r).map(s=>(0,c.jsxs)("div",{className:"playlist-entry",children:[S(s.id),(0,c.jsxs)("div",{className:"playlist-entry-content",children:[N?.id===s.id?(0,c.jsx)("input",{type:"text",className:"input playlist-entry-title-input",defaultValue:s.title,onBlur:e=>function(e,t){const{title:n}=(0,p.LR)(t),s=e.target.value;s&&s!==n&&x(t,{title:s}),I(null)}(e,s.id),onKeyPress:A,autoFocus:!0}):(0,c.jsx)("h3",{className:"playlist-entry-title",children:s.title}),(0,c.jsxs)("div",{className:"playlist-entry-bottom",children:[s.isPrivate?(0,c.jsx)("span",{className:"playlist-entry-bottom-item",children:(0,c.jsx)(o.A,{id:"lock",className:"playlist-entry-bottom-icon",title:`Private to ${s.user.name}`})}):null,(0,c.jsxs)("span",{className:"playlist-entry-bottom-item",children:[s.tracks.length," track",1===s.tracks.length?"":"s"]}),(0,c.jsx)("span",{className:"playlist-entry-bottom-item",children:(0,p.qX)(s.id).duration}),(0,c.jsxs)(l.A,{container:{className:"playlist-entry-dropdown-container"},children:[(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>{return e=s.id,t=s.title,void I({id:e,title:t});var e,t},children:[(0,c.jsx)(o.A,{id:"edit",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Change Title"})]}),s.url?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>async function(s){const{initGoogleAPI:a,fetchPlaylistItems:o}=await Promise.resolve().then(n.bind(n,17));let l=e.user;(0,d.w3)("update-indicator-status",{id:s,visible:!0}),t({...e,playlistId:s,fetching:!0}),l||(l=await a(),"/"===i.pathname&&t({...e,user:l,playlistId:s,fetching:!0}));const c=await o(s,"sync");x(s,{tracks:(0,p.Ol)(c)}),(0,d.w3)("tracks",{id:s,type:"replace"}),s===g&&((0,b.Gx)(s),f&&((0,m.cb)(),(0,m.lK)(f.index,s))),"/"===i.pathname&&t({...e,user:l}),(0,d.w3)("update-indicator-status",{id:s,visible:!1})}(s.id),disabled:e.playlistId===s.id,children:[(0,c.jsx)(o.A,{id:"sync",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Sync to YouTube"})]}),(0,c.jsxs)("a",{href:s.url,className:"btn icon-text-btn dropdown-btn",target:"_blank",rel:"noreferrer",children:[(0,c.jsx)(o.A,{id:"link",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Open on YouTube"})]}),(0,c.jsxs)("label",{className:"checkbox-container playlist-entry-dropdown-setting",children:[(0,c.jsx)("input",{type:"checkbox",className:"sr-only checkbox-input",checked:s.sync,onChange:e=>function({target:e},t){x(t,{sync:e.checked})}(e,s.id)}),(0,c.jsx)("div",{className:"checkbox",children:(0,c.jsx)("div",{className:"checkbox-tick"})}),(0,c.jsx)("span",{className:"checkbox-label",children:"Sync on load"})]})]}):null,(0,c.jsxs)("button",{className:"btn icon-text-btn dropdown-btn",onClick:()=>h(s.id),children:[(0,c.jsx)(o.A,{id:"trash",className:"dropdown-btn-icon"}),(0,c.jsx)("span",{children:"Remove"})]})]})]})]})]},s.id)):null},x=(0,s.lazy)(()=>n.e(429).then(n.bind(n,429)));const g=function(){const[e,t]=(0,s.useState)(()=>({user:(0,i.wz)()}));return(0,c.jsxs)("div",{className:"home","data-dropdown-parent":!0,children:[(0,c.jsx)(r,{youtube:e,setYoutube:t}),(0,c.jsx)(h,{youtube:e,setYoutube:t}),e.modalVisible&&(0,c.jsx)(s.Suspense,{fallback:null,children:(0,c.jsx)(x,{youtube:e,setYoutube:t})})]})}}}]);